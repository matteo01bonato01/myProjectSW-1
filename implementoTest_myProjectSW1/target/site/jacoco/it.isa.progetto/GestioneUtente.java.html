<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GestioneUtente.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">myProjectSW1</a> &gt; <a href="index.source.html" class="el_package">it.isa.progetto</a> &gt; <span class="el_source">GestioneUtente.java</span></div><h1>GestioneUtente.java</h1><pre class="source lang-java linenums">package it.isa.progetto;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Font;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.text.AttributeSet;
import javax.swing.text.BadLocationException;
import javax.swing.text.PlainDocument;


class JTextFieldLimit extends PlainDocument {
	   private int limit;
	   JTextFieldLimit(int limit) {
<span class="fc" id="L35">	      super();</span>
<span class="fc" id="L36">	      this.limit = limit;</span>
<span class="fc" id="L37">	   }</span>
	   JTextFieldLimit(int limit, boolean upper) {
<span class="fc" id="L39">	      super();</span>
<span class="fc" id="L40">	      this.limit = limit;</span>
<span class="fc" id="L41">	   }</span>
	   public void insertString(int offset, String str, AttributeSet attr) throws BadLocationException {
<span class="fc bfc" id="L43" title="All 2 branches covered.">	      if (str == null)</span>
<span class="fc" id="L44">	         return;</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">	      if ((getLength() + str.length()) &lt;= limit) {</span>
<span class="fc" id="L46">	         super.insertString(offset, str, attr);</span>
	      }
<span class="fc" id="L48">	   }</span>
	}



<span class="fc" id="L53">public class GestioneUtente {</span>
	
	private static JFrame fListaEventi, framePrenotami, frModifica;
	private static JPanel jpListaEventi, pannelloPrenotami, panModifica;
<span class="fc" id="L57">	static String url = &quot;jdbc:db2://localhost:25000/SAMPLE:retrieveMessagesFromServerOnGetMessage=true;&quot;;</span>
	static Connection con;
	static Statement stmt;
	static JTextField nome_evento_prenotato, nome_evento_prenotabile;
	static JTextField jlogin, jnome, jcognome, jemail, jgiornonascita, jmesenascita, jannonascita;
	static JPasswordField jpsw;
	
	
	

	/*********** TABELLA CON TUTTI GLI EVENTI **************************/
	void esegui(String user, String password) {
		//apro la finestra per profilo personale
<span class="fc" id="L70">		modificaProfilo(user);</span>
		
		
		
		try {
<span class="fc" id="L75">			Class.forName(&quot;com.ibm.db2.jcc.DB2Driver&quot;);</span>

<span class="nc" id="L77">		} catch(java.lang.ClassNotFoundException e) {</span>
<span class="nc" id="L78">			System.err.print(&quot;ClassNotFoundException: &quot;); </span>
<span class="nc" id="L79">			System.err.println(e.getMessage());</span>
<span class="fc" id="L80">		}</span>
		
		
		
		//Creo unJFrame per visualizzare la tabella
<span class="fc" id="L85">		fListaEventi = new JFrame(&quot;Eventi in programma&quot;);</span>
<span class="fc" id="L86">		fListaEventi.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="fc" id="L87">		jpListaEventi = new JPanel();</span>
<span class="fc" id="L88">		JLabel l = new JLabel();</span>
		
		//di default viene tutto grassetto; questo lo rimuove
<span class="fc" id="L91">		Font font = l.getFont();</span>
		// unbold
<span class="fc" id="L93">		l.setFont(font.deriveFont(font.getStyle() &amp; ~Font.BOLD));</span>

<span class="fc" id="L95">		l.setHorizontalAlignment(SwingConstants.CENTER);</span>
<span class="fc" id="L96">		l.setVerticalAlignment(SwingConstants.CENTER);</span>
		
<span class="fc" id="L98">        l.setBackground(Color.GREEN);</span>
<span class="fc" id="L99">        l.setOpaque(true);</span>
		//aggiungo label al pannello Stadi
<span class="fc" id="L101">		l.add(jpListaEventi);</span>
		//e lo aggiungo al frame
<span class="fc" id="L103">		fListaEventi.add(l, BorderLayout.CENTER);</span>
		
<span class="fc" id="L105">		fListaEventi.setLocation(10, 150);</span>
<span class="fc" id="L106">		fListaEventi.setSize(1100,400);</span>
<span class="fc" id="L107">		fListaEventi.setVisible(true);</span>
		
		//l.setText(&quot;&quot;);
<span class="fc" id="L110">		l.setText(&quot;&lt;html&gt;&lt;table border = 1&gt;&lt;tr style='font-weight: bold'&gt;&quot; +</span>
        		&quot;&lt;td&gt;EVENTO&lt;/td&gt;&lt;td&gt;LOCATON&lt;/td&gt;&lt;td&gt;ARTISTA&lt;/td&gt;&lt;td&gt;DATA&lt;/td&gt;&quot; + 
				&quot;&lt;td&gt;PREZZO&lt;/td&gt;&lt;td&gt;DISPONIBILITA'&lt;/td&gt;&lt;/tr&gt;&quot;);
        
        
		try {
<span class="fc" id="L116">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L117">			stmt = con.createStatement();</span>
			
<span class="fc" id="L119">			ResultSet rs = stmt.executeQuery(&quot;select * from EVENTO;&quot;);</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">			while(rs.next()) {</span>
				/*
				 * essendoci ambiguita nell'estrarre il campo nome,
				 * ho specificato la tabella da cui estrarre il NOME EVENTO
				 * si potrebbe aggiungere opzionalmente ORDER BY
				 */
<span class="fc" id="L126">				String nome_evento = rs.getString(&quot;NOME_EVENTO&quot;);</span>
<span class="fc" id="L127">				String nome_location = rs.getString(&quot;NOME_LOCATION&quot;);</span>
<span class="fc" id="L128">				String nome_artista = rs.getString(&quot;NOME_ARTISTA&quot;);</span>
<span class="fc" id="L129">				String data = rs.getString(&quot;DATA_EVENTO&quot;);</span>
<span class="fc" id="L130">				String prezzo = rs.getString(&quot;PREZZO&quot;);</span>
<span class="fc" id="L131">				String disponibilita = rs.getString(&quot;DISPONIBILITA&quot;);</span>
				
				//Mostro risultati nella tabella
<span class="fc" id="L134">		        l.setText(l.getText() + &quot;&lt;tr&gt;&lt;td&gt;&quot;+ nome_evento + &quot; &lt;/td&gt;&lt;td&gt;&quot; + nome_location + </span>
		        		&quot;&lt;/td&gt;&lt;td&gt; &quot; + nome_artista +&quot; &lt;/td&gt;&lt;td&gt; &quot; + data + &quot;&lt;/td&gt;&lt;td&gt; &quot; + prezzo + 
		        		&quot; â‚¬ &lt;/td&gt;&lt;td&gt;&quot; + disponibilita + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="fc" id="L137">			}</span>
			
<span class="fc" id="L139">			l.setText(l.getText() + &quot;&lt;/table&gt;&lt;/html&gt;&quot;);</span>
			
			
			//richiamo metodo per inserimento e cancellazione prenotazioni
<span class="fc" id="L143">			prenota_cancella(user, password);</span>
			
<span class="nc" id="L145">		} catch (SQLException e1) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L147">			System.err.println(&quot;Errore su Gestione utente: estrazione colonne eventi da mostrare: &quot;);</span>
<span class="nc" id="L148">			e1.printStackTrace();</span>
<span class="fc" id="L149">		}</span>
		
<span class="fc" id="L151">	}//esegui</span>
	
	
	
	
	
	
	
	
	
	
	
	

	/*********** TABELLA PER PRENOTARSI/CANCELLARSI AGLI/DAGLI EVENTI **************************/
	void prenota_cancella(final String user, final String password) {
		
		//Creo JFrame per effettuare mie prenotazioni
<span class="fc" id="L169">        framePrenotami = new JFrame(&quot;Lista per cancellazione/iscrizione dagli/agli eventi&quot;);</span>
<span class="fc" id="L170">        framePrenotami.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="fc" id="L171">        pannelloPrenotami = new JPanel(new GridLayout(0, 1));</span>

		//CREO MENU A TENDINA PER SELEZIONARE GLI EVENTI A CUI SONO ISCRITTO
<span class="fc" id="L174">		JMenuBar jmb = new JMenuBar();</span>
<span class="fc" id="L175">		JMenu menu = new JMenu(&quot;Seleziona evento: &quot;);</span>
<span class="fc" id="L176">		nome_evento_prenotato = new JTextField(&quot;&quot;,26);</span>
<span class="fc" id="L177">		nome_evento_prenotato.setEditable(false);</span>
<span class="fc" id="L178">		jmb.add(menu);</span>
		JMenuItem jmi;
		
		try {
<span class="fc" id="L182">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L183">        	stmt = con.createStatement();</span>
        	
<span class="fc" id="L185">        	stmt.execute(&quot;create or replace view VIEW&quot; + user + &quot;SUBSCRIBED &quot;</span>
        			+ &quot;AS select P.ID, P.ID_EVENTO, E.NOME_EVENTO, L.NOME_LOCATION &quot;
        			+ &quot;from LOCATION as L, EVENTO as E, PRENOTAZIONE as P, UTENTEREGISTRATO as UR &quot;
					+ &quot;where L.NOME_LOCATION=E.NOME_LOCATION and E.ID=P.ID_EVENTO and P.LOGIN_UR=UR.LOG &quot;
					+ &quot;and UR.LOG = '&quot; + user + &quot;';&quot;);
        	
<span class="fc" id="L191">			ResultSet rs = stmt.executeQuery(&quot;select ID, ID_EVENTO, NOME_EVENTO, NOME_LOCATION from VIEW&quot; + user + &quot;SUBSCRIBED;&quot;);</span>
<span class="fc" id="L192">			jmi = new JMenuItem(&quot;Svuota campo&quot;);</span>
<span class="fc" id="L193">			menu.add(jmi);</span>
			
			
<span class="fc bfc" id="L196" title="All 2 branches covered.">			while(rs.next()) {</span>
<span class="fc" id="L197">				jmi = new JMenuItem(rs.getString(&quot;ID&quot;).trim() + &quot;. (&quot; + rs.getString(&quot;ID_EVENTO&quot;) +&quot;) &quot; </span>
<span class="fc" id="L198">						+ rs.getString(&quot;NOME_EVENTO&quot;).trim() + &quot; -/- &quot; + rs.getString(&quot;NOME_LOCATION&quot;).trim());</span>
<span class="fc" id="L199">		        menu.add(jmi);		</span>
			}
<span class="fc" id="L201">		} catch(SQLException ex) {</span>
<span class="fc" id="L202">			System.err.println(&quot;Errore su Gestione utente: estrazione colonne eventi sul metodo prenota_cancella: &quot;);</span>
<span class="fc" id="L203">			System.err.println(&quot;SQLException: &quot; + ex.getMessage());</span>
<span class="fc" id="L204">		}</span>
		

<span class="fc bfc" id="L207" title="All 2 branches covered.">		for(int i=0; i &lt; menu.getItemCount(); i++) {</span>
<span class="fc bfc" id="L208" title="All 2 branches covered.">			if(i==0) {</span>
<span class="fc" id="L209">				menu.getItem(i).addActionListener(new ActionListener(){  </span>
					public void actionPerformed(ActionEvent e){  
<span class="nc" id="L211">						nome_evento_prenotato.setText(&quot;&quot;);</span>
<span class="nc" id="L212">					}</span>
				});
			}else {
<span class="fc" id="L215">				final String s = menu.getItem(i).getText();</span>
<span class="fc" id="L216">				menu.getItem(i).addActionListener(new ActionListener(){  </span>
					public void actionPerformed(ActionEvent e){  
<span class="nc" id="L218">						nome_evento_prenotato.setText(s);</span>
<span class="nc" id="L219">					}</span>
				});
			}
		}
		
<span class="fc" id="L224">		JButton elimina_prenotazione = new JButton(&quot;ELIMINA PRENOTAZIONE&quot;);</span>
<span class="fc" id="L225">		elimina_prenotazione.addActionListener(new ActionListener(){  </span>
			public void actionPerformed(ActionEvent e){
				
				try {
<span class="nc" id="L229">					String estrai = nome_evento_prenotato.getText();</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">					if(estrai != null){</span>
						
						//eliminazione
<span class="nc" id="L233">						String[] num = estrai.split(&quot;. &quot;);</span>
<span class="nc" id="L234">						int idPrenotazione = Integer.parseInt(num[0]);</span>
						
<span class="nc" id="L236">						String id_eevento = estrai.substring(estrai.indexOf(&quot;(&quot;)+1, estrai.indexOf(&quot;)&quot;));</span>
<span class="nc" id="L237">						int id_evento = Integer.parseInt(id_eevento);</span>
						/*se tutto Ã¨ andato a buon fine,
						 * allora avviene l'effettiva
						 * eliminazione della prenotazione
						 * */
<span class="nc bnc" id="L242" title="All 2 branches missed.">						if(idPrenotazione &gt; 0) {</span>
<span class="nc" id="L243">							framePrenotami.setVisible(false);</span>
<span class="nc" id="L244">							delEvento(idPrenotazione, id_evento, user, password);</span>

<span class="nc" id="L246">							System.out.println(&quot;idEvento a cui mi sto cancellando: &quot;+id_evento);</span>
						}
					} 
<span class="nc" id="L249">				} catch (Exception e1) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L251">					e1.printStackTrace();</span>
<span class="nc" id="L252">				}</span>
					
<span class="nc" id="L254">	        }  </span>
	    });
		
<span class="fc" id="L257">		pannelloPrenotami.add(jmb, &quot;center&quot;);</span>
<span class="fc" id="L258">		pannelloPrenotami.add(nome_evento_prenotato, &quot;center&quot;);</span>
<span class="fc" id="L259">		pannelloPrenotami.add(elimina_prenotazione);</span>
		
		
		
		
		
		
		
		
<span class="fc" id="L268">		JMenuBar jmb2 = new JMenuBar();</span>
<span class="fc" id="L269">		JMenu menu2 = new JMenu(&quot;Seleziona evento: &quot;);</span>
<span class="fc" id="L270">		nome_evento_prenotabile = new JTextField(&quot;&quot;,26);</span>
<span class="fc" id="L271">		nome_evento_prenotabile.setEditable(false);</span>
<span class="fc" id="L272">		jmb2.add(menu2);</span>
		JMenuItem jmi2;
		
		try {
<span class="fc" id="L276">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L277">        	stmt = con.createStatement();</span>
        	
        	/*
        	 * 5 ore per farlo funzionare: devo escludere le tuple in cui compare il login
        	 * di tale user, e escludere l'id dell'evento (prelevabile dalla precedente View)
        	 * senno compaiono le possibili altre prenotazioni degli altri
        	 */
<span class="fc" id="L284">        	stmt.execute(&quot;create or replace view VIEW&quot; + user + &quot;PRENOTABLE &quot;</span>
        			+ &quot;AS select E.ID, E.NOME_EVENTO, E.NOME_LOCATION, E.DISPONIBILITA &quot;
        			+ &quot;from LOCATION as L, EVENTO as E &quot;
					//+ &quot;where L.NOME_LOCATION=E.NOME_LOCATION and E.ID = P.ID_EVENTO and P.LOGIN_UR=UR.LOG &quot;
					+ &quot;where E.NOME_LOCATION=L.NOME_LOCATION and E.DISPONIBILITA&gt;0 &quot;
					+ &quot;and E.ID NOT IN (select ID_EVENTO from VIEW&quot; + user + &quot;SUBSCRIBED);&quot;);
        	
<span class="fc" id="L291">			ResultSet rs2 = stmt.executeQuery(&quot;select * from VIEW&quot; + user + &quot;PRENOTABLE;&quot;);</span>
<span class="fc" id="L292">			jmi2 = new JMenuItem(&quot;Svuota campo&quot;);</span>
<span class="fc" id="L293">			menu2.add(jmi2);</span>
			
<span class="fc bfc" id="L295" title="All 2 branches covered.">			while(rs2.next()) {</span>
<span class="fc" id="L296">				jmi2 = new JMenuItem(rs2.getString(&quot;ID&quot;).trim() + &quot;. &quot; + rs2.getString(&quot;NOME_EVENTO&quot;).trim()</span>
<span class="fc" id="L297">						+ &quot; -/- &quot; + rs2.getString(&quot;NOME_LOCATION&quot;).trim() + &quot; (&quot; + rs2.getString(&quot;DISPONIBILITA&quot;) + &quot;)&quot;);</span>
<span class="fc" id="L298">		        menu2.add(jmi2);</span>
			}
<span class="fc" id="L300">		} catch(SQLException ex) {</span>
<span class="fc" id="L301">			System.err.println(&quot;SQLException on ResultSet2: &quot; + ex.getMessage());</span>
<span class="fc" id="L302">		}</span>
		

<span class="fc bfc" id="L305" title="All 2 branches covered.">		for(int i=0; i &lt; menu2.getItemCount(); i++) {</span>
<span class="fc bfc" id="L306" title="All 2 branches covered.">			if(i==0) {</span>
<span class="fc" id="L307">				menu2.getItem(i).addActionListener(new ActionListener(){  </span>
					public void actionPerformed(ActionEvent e){  
<span class="nc" id="L309">						nome_evento_prenotabile.setText(&quot;&quot;);</span>
<span class="nc" id="L310">					}</span>
				});
			}else {
<span class="fc" id="L313">				final String s2 = menu2.getItem(i).getText();</span>
<span class="fc" id="L314">				menu2.getItem(i).addActionListener(new ActionListener(){  </span>
					public void actionPerformed(ActionEvent e){  
<span class="nc" id="L316">						nome_evento_prenotabile.setText(s2);</span>
<span class="nc" id="L317">					}</span>
				});
			}
		}
		
<span class="fc" id="L322">		JButton aggiungi_prenotazione = new JButton(&quot;AGGIUNGI PRENOTAZIONE&quot;);</span>
<span class="fc" id="L323">		aggiungi_prenotazione.addActionListener(new ActionListener(){  </span>
			public void actionPerformed(ActionEvent e){
				
				try {
<span class="nc" id="L327">					String estrai = nome_evento_prenotabile.getText();</span>
					
<span class="nc bnc" id="L329" title="All 2 branches missed.">					if(estrai != null) {</span>
<span class="nc" id="L330">						String[] num = estrai.split(&quot;. &quot;);</span>
<span class="nc" id="L331">						int idEvento = Integer.parseInt(num[0]);</span>

						/*
						 * se tutto Ã¨ andato a buon fine,
						 * allora effettuo il vero inserimento
						 */
<span class="nc bnc" id="L337" title="All 2 branches missed.">						if(idEvento &gt;0) {</span>
<span class="nc" id="L338">							framePrenotami.setVisible(false);</span>
<span class="nc" id="L339">							addEvento(idEvento, user, password);</span>
<span class="nc" id="L340">							System.out.println(&quot;idEvento a cui mi sto prenotando: &quot;+idEvento);</span>
						}
					}
<span class="nc" id="L343">				} catch (Exception e1) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L345">					e1.printStackTrace();</span>
<span class="nc" id="L346">				}</span>
<span class="nc" id="L347">	        }  </span>
	    });
		
		
<span class="fc" id="L351">		pannelloPrenotami.add(jmb2, &quot;center&quot;);</span>
<span class="fc" id="L352">		pannelloPrenotami.add(nome_evento_prenotabile, &quot;center&quot;);</span>
<span class="fc" id="L353">		pannelloPrenotami.add(aggiungi_prenotazione);</span>
		
		
		/* aggiungo i panel al frame */
<span class="fc" id="L357">		pannelloPrenotami.setBackground(Color.RED);</span>
<span class="fc" id="L358">		framePrenotami.add(pannelloPrenotami);</span>
<span class="fc" id="L359">		framePrenotami.setLocation(650, 150);</span>
<span class="fc" id="L360">		framePrenotami.setSize(300,280);</span>
<span class="fc" id="L361">		framePrenotami.setVisible(true);</span>
		
<span class="fc" id="L363">	}</span>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	void delEvento(int id_prenotazione, int id_evento, String login, String passw) {
		try {
<span class="fc" id="L384">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L385">	    	stmt = con.createStatement();</span>
	    	
<span class="fc" id="L387">	    	stmt.execute(&quot;delete from PRENOTAZIONE where ID=&quot; + id_prenotazione + &quot;;&quot;);</span>
	    	
			//System.out.println(id_prenotazione);
<span class="fc" id="L390">		} catch (Exception e1) {</span>
				// TODO Auto-generated catch block
<span class="fc" id="L392">				System.err.println(&quot;Errore cancellazione Prenotazione: &quot;);</span>
<span class="fc" id="L393">				e1.printStackTrace();</span>
<span class="fc" id="L394">		}</span>
		
		try {
<span class="fc" id="L397">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L398">	    	stmt = con.createStatement();</span>
	    	
<span class="fc" id="L400">	    	stmt.execute(&quot;update EVENTO set DISPONIBILITA = DISPONIBILITA + 1 where ID=&quot; + id_evento + &quot;;&quot;);</span>
	    	
			//System.out.println(id_prenotazione);
<span class="fc" id="L403">		} catch (Exception e1) {</span>
				// TODO Auto-generated catch block
<span class="fc" id="L405">				System.err.println(&quot;Errore aggiornamento disponibilita dell'evento su delEvento: &quot;);</span>
<span class="fc" id="L406">				e1.printStackTrace();</span>
<span class="fc" id="L407">		}</span>
		
<span class="fc" id="L409">    	prenota_cancella(login, passw);</span>
<span class="fc" id="L410">	}</span>
	
	
	
	

	void addEvento(int id_evento, String login, String passw) {
		try {
<span class="fc" id="L418">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L419">	    	stmt = con.createStatement();</span>
	    	
<span class="fc" id="L421">	    	stmt.execute(&quot;insert into PRENOTAZIONE(LOGIN_UR, ID_EVENTO) values('&quot; + login + &quot;', '&quot; + id_evento + &quot;');&quot;);</span>
	
	    	//System.out.println(id_evento);
<span class="fc" id="L424">		} catch (SQLException ex) {</span>
			// TODO Auto-generated catch block
<span class="fc" id="L426">			System.err.print(&quot;ERRORE su add PRENOTAZIONE in addEvento&quot;);</span>
<span class="fc" id="L427">			ex.printStackTrace();</span>
<span class="fc" id="L428">		}</span>
		
		try {
<span class="fc" id="L431">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L432">	    	stmt = con.createStatement();</span>
	    	
<span class="fc" id="L434">	    	stmt.execute(&quot;update EVENTO set DISPONIBILITA = DISPONIBILITA - 1 where ID=&quot; + id_evento + &quot;;&quot;);</span>
	    	
			//System.out.println(id_prenotazione);
<span class="fc" id="L437">		} catch (Exception e1) {</span>
				// TODO Auto-generated catch block
<span class="fc" id="L439">				System.err.println(&quot;Errore aggiornamento disponibilita dell'evento in addEvento: &quot;);</span>
<span class="fc" id="L440">				e1.printStackTrace();</span>
<span class="fc" id="L441">		}</span>
		
<span class="fc" id="L443">    	prenota_cancella(login, passw);</span>
    	
<span class="fc" id="L445">	}</span>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	/************* MODIFICA TUO PROFILO *****************/
	void modificaProfilo(String log) {
		
<span class="fc" id="L465">        frModifica = new JFrame(&quot;Modifica Profilo&quot;);</span>
<span class="fc" id="L466">        frModifica.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="fc" id="L467">		panModifica = new JPanel(new GridLayout(0,3));</span>
		
		
		try {
<span class="fc" id="L471">			Class.forName(&quot;com.ibm.db2.jcc.DB2Driver&quot;);</span>

<span class="nc" id="L473">		} catch(java.lang.ClassNotFoundException err) {</span>
<span class="nc" id="L474">			System.err.print(&quot;ClassNotFoundException: &quot;); </span>
<span class="nc" id="L475">			System.err.println(err.getMessage());</span>
<span class="fc" id="L476">		}</span>


		try {
<span class="fc" id="L480">        	con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L481">			stmt = con.createStatement();</span>
        	//stmt.execute(&quot;select * from UTENTEREGISTRATO where LOG='&quot; + log + &quot;';&quot;);
<span class="fc" id="L483">        	ResultSet rsmodifica = stmt.executeQuery(&quot;select * from UTENTEREGISTRATO where LOG='&quot; + log + &quot;';&quot;);</span>
        	
<span class="fc bfc" id="L485" title="All 2 branches covered.">        	while(rsmodifica.next()) {</span>
        		/*rsmodifica.getString(&quot;NOME&quot;);
        		rsmodifica.getString(&quot;COGNOME&quot;);
        		rsmodifica.getString(&quot;DATA_NASCITA&quot;);
        		rsmodifica.getString(&quot;EMAIL&quot;);
        		 */
			

<span class="fc" id="L493">				jlogin = new JTextField(rsmodifica.getString(&quot;LOG&quot;).trim());</span>
<span class="fc" id="L494">				jlogin.setEditable(false);</span>
	
				
<span class="fc" id="L497">				jpsw = new JPasswordField(rsmodifica.getString(&quot;PASSW&quot;).trim());</span>
				

<span class="fc" id="L500">				jnome = new JTextField();</span>
<span class="fc" id="L501">				jnome.setEditable(false);</span>
<span class="fc" id="L502">				jnome.setText(rsmodifica.getString(&quot;NOME&quot;).trim());</span>
	
<span class="fc" id="L504">				jcognome = new JTextField();</span>
<span class="fc" id="L505">				jcognome.setDocument(new JTextFieldLimit(11));</span>
<span class="fc" id="L506">				jcognome.setText(rsmodifica.getString(&quot;COGNOME&quot;).trim());</span>
				
				
<span class="fc" id="L509">				jgiornonascita = new JTextField(rsmodifica.getString(&quot;DATA_NASCITA&quot;).substring(8,10).trim(),2);</span>
<span class="fc" id="L510">				jgiornonascita.addKeyListener(new KeyAdapter() {</span>
			         public void keyTyped(KeyEvent e) {
<span class="nc" id="L512">			             char c = e.getKeyChar();</span>
<span class="nc bnc" id="L513" title="All 6 branches missed.">			             if ( ((c &lt; '0') || (c &gt; '9')) &amp;&amp; (c != KeyEvent.VK_BACK_SPACE)) {</span>
<span class="nc" id="L514">			                  e.consume();  // if it's not a number, ignore the event</span>
			             }
<span class="nc" id="L516">			         }</span>
			      });
<span class="fc" id="L518">				jmesenascita = new JTextField(rsmodifica.getString(&quot;DATA_NASCITA&quot;).substring(5,7).trim(),2);</span>
<span class="fc" id="L519">				jmesenascita.addKeyListener(new KeyAdapter() {</span>
			         public void keyTyped(KeyEvent e) {
<span class="nc" id="L521">			             char c = e.getKeyChar();</span>
<span class="nc bnc" id="L522" title="All 6 branches missed.">			             if ( ((c &lt; '0') || (c &gt; '9')) &amp;&amp; (c != KeyEvent.VK_BACK_SPACE)) {</span>
<span class="nc" id="L523">			                  e.consume();  // if it's not a number, ignore the event</span>
			             }
<span class="nc" id="L525">			         }</span>
			      });
<span class="fc" id="L527">				jannonascita = new JTextField(rsmodifica.getString(&quot;DATA_NASCITA&quot;).substring(0,4).trim(),4);</span>
<span class="fc" id="L528">				jannonascita.addKeyListener(new KeyAdapter() {</span>
			         public void keyTyped(KeyEvent e) {
<span class="nc" id="L530">			             char c = e.getKeyChar();</span>
<span class="nc bnc" id="L531" title="All 6 branches missed.">			             if ( ((c &lt; '0') || (c &gt; '9')) &amp;&amp; (c != KeyEvent.VK_BACK_SPACE)) {</span>
<span class="nc" id="L532">			                  e.consume();  // if it's not a number, ignore the event</span>
			             }
<span class="nc" id="L534">			         }</span>
			      });
				
				
				
<span class="fc" id="L539">				jemail = new JTextField();</span>
<span class="fc" id="L540">				jemail.setDocument(new JTextFieldLimit(25));</span>
<span class="fc" id="L541">				jemail.setText(rsmodifica.getString(&quot;EMAIL&quot;).trim());</span>
				

<span class="fc" id="L544">				JButton jmodifica = new JButton(&quot;SALVA MODIFICHE&quot;);</span>
				
				
				//jvuoto solo per allineare le colonne sfasate a causa della data di nascita
<span class="fc" id="L548">				JTextField jvuoto = new JTextField();</span>
<span class="fc" id="L549">				jvuoto.setEditable(false);</span>
<span class="fc" id="L550">				JTextField jvuoto1 = new JTextField();</span>
<span class="fc" id="L551">				jvuoto1.setEditable(false);</span>
<span class="fc" id="L552">				JTextField jvuoto2 = new JTextField();</span>
<span class="fc" id="L553">				jvuoto2.setEditable(false);</span>
<span class="fc" id="L554">				JTextField jvuoto3 = new JTextField();</span>
<span class="fc" id="L555">				jvuoto3.setEditable(false);</span>
<span class="fc" id="L556">				JTextField jvuoto4 = new JTextField();</span>
<span class="fc" id="L557">				jvuoto4.setEditable(false);</span>
				
				

<span class="fc" id="L561">				panModifica.add(jlogin);</span>
<span class="fc" id="L562">				panModifica.add(jpsw);</span>
<span class="fc" id="L563">				panModifica.add(jvuoto);</span>
<span class="fc" id="L564">				panModifica.add(jnome);</span>
<span class="fc" id="L565">				panModifica.add(jcognome);</span>
<span class="fc" id="L566">				panModifica.add(jvuoto1);</span>
<span class="fc" id="L567">				panModifica.add(jgiornonascita);</span>
<span class="fc" id="L568">				panModifica.add(jmesenascita);</span>
<span class="fc" id="L569">				panModifica.add(jannonascita);</span>
<span class="fc" id="L570">				panModifica.add(jemail);</span>
<span class="fc" id="L571">				panModifica.add(jvuoto2);</span>
<span class="fc" id="L572">				panModifica.add(jvuoto3);</span>
<span class="fc" id="L573">				panModifica.add(jvuoto4);</span>
<span class="fc" id="L574">				panModifica.add(jmodifica);</span>
				//panModifica.setBackground(Color.YELLOW);
<span class="fc" id="L576">				frModifica.add(panModifica);</span>
		
<span class="fc" id="L578">				frModifica.setLocation(980, 150);</span>
<span class="fc" id="L579">				frModifica.setSize(430,200);</span>
<span class="fc" id="L580">				frModifica.setVisible(true);</span>
				
<span class="fc" id="L582">				jmodifica.addActionListener(new ActionListener(){ </span>
					public void actionPerformed(ActionEvent e){
						
<span class="nc" id="L585">						char[] p = jpsw.getPassword();</span>
<span class="nc" id="L586">						String passwordInserita = new String(p);</span>
<span class="nc" id="L587">						String data = jannonascita.getText() + &quot;-&quot; + jmesenascita.getText() + &quot;-&quot; + jgiornonascita.getText();</span>
<span class="nc" id="L588">						updateModProfilo(jlogin.getText(), passwordInserita, jnome.getText(), jcognome.getText(), data, jemail.getText());</span>
						
<span class="nc" id="L590">						frModifica.setVisible(false);</span>
<span class="nc" id="L591">			        }</span>
			    });
<span class="fc" id="L593">			} //while</span>
<span class="nc" id="L594">		}catch (SQLException e1) {</span>
<span class="nc" id="L595">			System.out.println(&quot;Errore nella ricerca dell'utente per la modifica dei propri dati: &quot;);</span>
<span class="nc" id="L596">			e1.printStackTrace();</span>
<span class="fc" id="L597">		}</span>
<span class="fc" id="L598">	}//fine metodo profilo</span>
	
	
	
	void updateModProfilo(String log, String passw, String nome, String cognome, String data_nascita, String email) {
		try {
<span class="fc" id="L604">			Class.forName(&quot;com.ibm.db2.jcc.DB2Driver&quot;);</span>

<span class="nc" id="L606">		} catch(java.lang.ClassNotFoundException err) {</span>
<span class="nc" id="L607">			System.err.print(&quot;ClassNotFoundException: &quot;); </span>
<span class="nc" id="L608">			System.err.println(err.getMessage());</span>
<span class="nc" id="L609">	   		System.out.println(&quot;mod fatta&quot;);</span>
<span class="fc" id="L610">		}</span>


		try {
<span class="fc" id="L614">        	con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L615">			stmt = con.createStatement();</span>
<span class="fc" id="L616">        	stmt.executeUpdate(&quot;update UTENTEREGISTRATO&quot;</span>
        			+ &quot; set PASSW='&quot;+passw+&quot;', NOME='&quot;+nome+&quot;', COGNOME='&quot;+cognome
        			+ &quot;', DATA_NASCITA='&quot;+ data_nascita +&quot;', EMAIL='&quot;+email+&quot;'&quot;
        			+ &quot;  where LOG='&quot; + log + &quot;';&quot;);
			
<span class="nc" id="L621">		} catch (SQLException e1) {</span>
<span class="nc" id="L622">			System.out.println(&quot;Errore aggiornamento dati personali dell'utente: &quot;);</span>
<span class="nc" id="L623">			e1.printStackTrace();</span>
<span class="fc" id="L624">		}</span>
		
<span class="fc" id="L626">		modificaProfilo(log);</span>
<span class="fc" id="L627">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>