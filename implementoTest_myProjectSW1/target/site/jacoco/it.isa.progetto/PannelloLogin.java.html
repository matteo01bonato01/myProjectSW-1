<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PannelloLogin.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">myProjectSW1</a> &gt; <a href="index.source.html" class="el_package">it.isa.progetto</a> &gt; <span class="el_source">PannelloLogin.java</span></div><h1>PannelloLogin.java</h1><pre class="source lang-java linenums">package it.isa.progetto;

import java.awt.Color;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JTextField;
import javax.swing.Timer;

<span class="fc" id="L20">public class PannelloLogin {</span>

<span class="fc" id="L22">	static String url = &quot;jdbc:db2://localhost:25000/SAMPLE:retrieveMessagesFromServerOnGetMessage=true;&quot;;</span>
	static Connection con;
	static Statement stmt, stmtcheck;
	
	
	private JFrame frTabLogin, frTabConferma;
	private JPanel jpTabLogin;
	private JLabel jlRisultato;
	private JTextField user;
	private JPasswordField passw;
	
	
	public void show() {
		/******** PARTE CON INTERF. GRAFICA **********/
		//Creo un JFrame per login
<span class="fc" id="L37">		frTabLogin = new JFrame(&quot;Autenticazione&quot;);</span>
<span class="fc" id="L38">		frTabLogin.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="fc" id="L39">		frTabLogin.setResizable(false);</span>
		
		/*************** CREO RIGA PER INSERIMENTO ******************/
<span class="fc" id="L42">		jpTabLogin = new JPanel();</span>
<span class="fc" id="L43">		jpTabLogin.setAlignmentX((float) 0.6);</span>
		
		//campi
<span class="fc" id="L46">		user = new JTextField(&quot;username&quot;,40);</span>
<span class="fc" id="L47">		user.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="fc" id="L48">		passw = new JPasswordField(&quot;password&quot;,40);</span>
<span class="fc" id="L49">		passw.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="fc" id="L50">		JButton jbinvia = new JButton(&quot;ACCEDI&quot;);</span>
<span class="fc" id="L51">		jbinvia.setHorizontalAlignment(JTextField.CENTER);</span>
		
		
        
		
<span class="fc" id="L56">		jpTabLogin.add(user);</span>
<span class="fc" id="L57">		jpTabLogin.add(passw);</span>
<span class="fc" id="L58">		jpTabLogin.add(jbinvia);</span>
		
<span class="fc" id="L60">		jpTabLogin.setBackground(Color.YELLOW);</span>
<span class="fc" id="L61">		frTabLogin.add(jpTabLogin);</span>
<span class="fc" id="L62">		frTabLogin.setLocation(250, 190);</span>
<span class="fc" id="L63">		frTabLogin.setSize(350,300);</span>
<span class="fc" id="L64">		frTabLogin.setVisible(true);</span>
		
<span class="fc" id="L66">		jbinvia.addActionListener(new ActionListener(){  </span>
			public void actionPerformed(ActionEvent e){
				
				 /*Fai il check login se almeno l'utente ha scritto l'username
				 * In altre parole: attiva tutto se hai scritto almeno la passw
				 * */
				//System.out.println(&quot;Cosa ricevo: &quot; + user.getText().trim()+&quot;\\&quot;);
				
<span class="nc" id="L74">					frTabLogin.setVisible(false);</span>
					/* SPOSTATO IN CHECK-LOGIN
					//Creo un JFrame per Swing di conferma
					frTabConferma = new JFrame(&quot;Conferma&quot;);
					frTabConferma.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
					//frTabConferma.setResizable(false);
					
					jlRisultato = new JLabel();
					jlRisultato.setOpaque(true);		//questi due assieme, senno non colorano lo sfondo
					jlRisultato.setBackground(Color.BLACK);//e questo
					
					
					jlRisultato.setForeground(Color.ORANGE);
					jlRisultato.setHorizontalAlignment((int)0.6);
					

					frTabConferma.add(jlRisultato);
					frTabConferma.setLocation(700, 460);
					frTabConferma.setSize(400,170);
					frTabConferma.setVisible(true);
					*/
					
<span class="nc" id="L96">					checkLogin(user, passw);</span>
					
					//import javax.swing.Timer; CHIUDO FINESTRA DOPO 3 SECONDI
					/*spostato in checkLogin
					 Timer timer = new Timer(3000, new ActionListener(){
					    public void actionPerformed(ActionEvent evt) {
					    	frTabConferma.dispose();
					    }
					});
					timer.setRepeats(false);
					timer.start();
					*/
					
				//}//IF
				
<span class="nc" id="L111">	        }  </span>
	    });
		
<span class="fc" id="L114">	}//show</span>
	
	
	

	public void checkLogin(JTextField userN, JPasswordField passw) {

<span class="fc" id="L121">		String nomeAutenticato = userN.getText();</span>
//		System.out.println(&quot;USER CONVERTITO DA JTEXTFIELD: &quot; + nomeAutenticato);
		
<span class="fc" id="L124">		char[] p = passw.getPassword();</span>
<span class="fc" id="L125">		String passwordInserita = new String(p);</span>
//		System.out.println(&quot;PASSWORD CONVERTITA DA JTEXTFIELD: &quot; + passwordInserita);
		
		//Creo un JFrame per Swing di conferma
<span class="fc" id="L129">		frTabConferma = new JFrame(&quot;Conferma&quot;);</span>
<span class="fc" id="L130">		frTabConferma.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
		//frTabConferma.setResizable(false);
		
<span class="fc" id="L133">		jlRisultato = new JLabel();</span>
<span class="fc" id="L134">		jlRisultato.setOpaque(true);		//questi due assieme, senno non colorano lo sfondo</span>
<span class="fc" id="L135">		jlRisultato.setBackground(Color.BLACK);//e questo</span>
		
		
<span class="fc" id="L138">		jlRisultato.setForeground(Color.ORANGE);</span>
<span class="fc" id="L139">		jlRisultato.setHorizontalAlignment((int)0.6);</span>
		

<span class="fc" id="L142">		frTabConferma.add(jlRisultato);</span>
<span class="fc" id="L143">		frTabConferma.setLocation(700, 460);</span>
<span class="fc" id="L144">		frTabConferma.setSize(400,170);</span>
<span class="fc" id="L145">		frTabConferma.setVisible(true);</span>
		
		
		
		// CONNESSIONE A DB2
		try {
<span class="fc" id="L151">			Class.forName(&quot;com.ibm.db2.jcc.DB2Driver&quot;);</span>

<span class="nc" id="L153">		} catch(java.lang.ClassNotFoundException e) {</span>
<span class="nc" id="L154">			System.err.print(&quot;ClassNotFoundException: &quot;); </span>
<span class="nc" id="L155">			System.err.println(e.getMessage());</span>
<span class="fc" id="L156">		}</span>
				
				
				
		try {
<span class="fc" id="L161">			con = DriverManager.getConnection(url,&quot;matteo&quot;,&quot;NuovaOpelCorsa&quot;);</span>
<span class="fc" id="L162">        	stmt = con.createStatement();</span>
        	
        	//cerco tra tutti gli utenti
<span class="fc" id="L165">        	ResultSet resultSetUser = stmt.executeQuery(&quot;select * from UTENTEREGISTRATO &quot;</span>
        			+ &quot;where LOG='&quot; + nomeAutenticato +&quot;' &quot;
        			+ &quot;and PASSW='&quot; + passwordInserita + &quot;';&quot;);
        	
        		
<span class="fc bfc" id="L170" title="All 2 branches covered.">	        	if(resultSetUser.next()) {</span>
<span class="fc" id="L171">	        		String log = resultSetUser.getString(&quot;LOG&quot;).trim();</span>
<span class="fc" id="L172">	        		String chiave = resultSetUser.getString(&quot;PASSW&quot;).trim();</span>
	        		
<span class="fc" id="L174">	        		jlRisultato.setForeground(Color.GREEN);</span>
<span class="fc" id="L175">					jlRisultato.setHorizontalAlignment((int)0.6);</span>
<span class="fc" id="L176">	        		jlRisultato.setText(&quot;&lt;html&gt;&lt;table&gt;&lt;td&gt;&lt;tr&gt;User: &quot; + log + </span>
	        				&quot; &lt;/tr&gt;&lt;tr&gt;Password: &quot; + chiave + &quot;&lt;/tr&gt;&quot; +
	        				&quot;&lt;/tr&gt;&lt;tr&gt;Autorizzazione: Risulti un utente registrato !!&lt;/tr&gt;&lt;/td&gt;&lt;/table&gt;&lt;/html&gt;&quot;);
	        		
<span class="fc" id="L180">	        		GestioneUtente gu = new GestioneUtente();</span>
<span class="fc" id="L181">	        		gu.esegui(log, chiave);</span>
<span class="fc" id="L182">	        	}</span>
	        	
	        	else {
	        		//cerco tra tutti gli artisti
<span class="fc" id="L186">	        		ResultSet resultSetArtist = stmt.executeQuery(&quot;select * from ARTISTA &quot;</span>
	            			+ &quot;where LOG='&quot; + nomeAutenticato +&quot;' &quot;
	            			+ &quot;and PASSW='&quot; + passwordInserita + &quot;';&quot;);
	        		
<span class="fc bfc" id="L190" title="All 2 branches covered.">	        		if(resultSetArtist.next()) {</span>
<span class="fc" id="L191">		        		String log = resultSetArtist.getString(&quot;LOG&quot;).trim();</span>
<span class="fc" id="L192">		        		String chiave = resultSetArtist.getString(&quot;PASSW&quot;).trim();</span>
		        		
		        		
<span class="fc" id="L195">		        		jlRisultato.setForeground(Color.GREEN);</span>
<span class="fc" id="L196">						jlRisultato.setHorizontalAlignment((int)0.6);</span>
<span class="fc" id="L197">		        		jlRisultato.setText(&quot;&lt;html&gt;&lt;table&gt;&lt;td&gt;&lt;tr&gt;User: &quot; + log + </span>
		        				&quot; &lt;/tr&gt;&lt;tr&gt;Password: &quot; + chiave + &quot;&lt;/tr&gt;&quot; +
		        				&quot;&lt;/tr&gt;&lt;tr&gt;Autorizzazione: Risulti un artista !!&lt;/tr&gt;&lt;/td&gt;&lt;/table&gt;&lt;/html&gt;&quot;);
		        		
<span class="fc" id="L201">		        		GestioneArtista ga = new GestioneArtista();</span>
<span class="fc" id="L202">		        		ga.esegui(log, chiave);</span>
<span class="fc" id="L203">		        	}</span>
	        		else {
<span class="fc" id="L205">	        			jlRisultato.setText(&quot;&lt;html&gt;Non sei stato autenticato.&lt;br&gt;Devi riprovare&lt;/html&gt;&quot;);</span>
<span class="fc" id="L206">	        			App.main(null);</span>
	        		}
	        			
	        	}
<span class="nc" id="L210">	        }catch (SQLException e1) {</span>
<span class="nc" id="L211">			System.out.println(&quot;Errore nella ricerca utente sul DB: &quot;);</span>
<span class="nc" id="L212">			e1.printStackTrace();</span>
<span class="fc" id="L213">		}</span>
		
		
		
		
<span class="fc" id="L218">		Timer timer = new Timer(3000, new ActionListener(){</span>
		    public void actionPerformed(ActionEvent evt) {
<span class="fc" id="L220">		    	frTabConferma.dispose();</span>
<span class="fc" id="L221">		    }</span>
		});
<span class="fc" id="L223">		timer.setRepeats(false);</span>
<span class="fc" id="L224">		timer.start();</span>
<span class="fc" id="L225">	}//checklogin</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>